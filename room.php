<?php

declare(strict_types=1);

if (session_status() == PHP_SESSION_NONE) {
    session_start();
}
require_once __DIR__ . '/rooms.php'; //Information about all the rooms
require_once __DIR__ . '/hotelFunctions.php';

$db = connect('hotel.db');

//Selected dates
if (isset($_SESSION['checkin'])) {
    $checkIn = $_SESSION['checkin'];
    $checkOut = $_SESSION['checkout'];
}

//Get the chosen room's id
$roomId = (int) $_GET['room_id'];

?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rainbow Reef Retreat</title>
    <link rel="stylesheet" href="styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
</head>

<body style="background: linear-gradient(270deg, #A1EEFF 0%, #FFD789 50%, #FFBEE1 100%);">
    <div class="navbar">
        <div class="logo"></div>
        <nav>
            <a href="/">The Island</a>
            <a href="/">The Hotel</a>
            <a href="/">Activities</a>
            <a href="/">Contact</a>
        </nav>
    </div>
    <main>
        <section class="room">

            <!-- PRESENT INFORMATION ABOUT CHOSEN ROOM -->

            <?php
            //Get information about chosen room
            foreach ($roomInfo as $room) {
                if ($roomId === $room['id']) {
                    $roomName = $room['name'];
                    $roomImg = $room['room_img'];
                    $roomDescpription = $room['room_description_first'];
                    $roomAmenities = $room['amenities'];
                }
            }
            ?>

            <div class="room-presentation">
                <div class="text">
                    <h2><?= $roomName ?></h2>
                    <p><?= $roomDescpription ?></p>
                    <ul>
                        <li> <svg width="20" height="20" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M28.125 17.8126H23.3848C23.4194 17.5013 23.437 17.1883 23.4375 16.8751C23.4375 14.6373 22.5486 12.4912 20.9662 10.9089C19.3839 9.32656 17.2378 8.43761 15 8.43761C12.7622 8.43761 10.6161 9.32656 9.03379 10.9089C7.45145 12.4912 6.5625 14.6373 6.5625 16.8751C6.56303 17.1883 6.58063 17.5013 6.61523 17.8126H1.875C1.62636 17.8126 1.3879 17.9114 1.21209 18.0872C1.03627 18.263 0.9375 18.5015 0.9375 18.7501C0.9375 18.9988 1.03627 19.2372 1.21209 19.413C1.3879 19.5888 1.62636 19.6876 1.875 19.6876H28.125C28.3736 19.6876 28.6121 19.5888 28.7879 19.413C28.9637 19.2372 29.0625 18.9988 29.0625 18.7501C29.0625 18.5015 28.9637 18.263 28.7879 18.0872C28.6121 17.9114 28.3736 17.8126 28.125 17.8126ZM8.4375 16.8751C8.43578 15.9727 8.62021 15.0796 8.97926 14.2516C9.33832 13.4236 9.86428 12.6787 10.5243 12.0632C11.1843 11.4477 11.9641 10.9749 12.8151 10.6745C13.6661 10.374 14.5699 10.2523 15.47 10.3169C16.3701 10.3816 17.2473 10.6312 18.0466 11.0501C18.8459 11.4691 19.5502 12.0484 20.1155 12.7519C20.6808 13.4554 21.0949 14.2679 21.332 15.1386C21.5691 16.0094 21.624 16.9197 21.4934 17.8126H8.50664C8.46126 17.5022 8.43816 17.1889 8.4375 16.8751ZM25.3125 23.4376C25.3125 23.6863 25.2137 23.9247 25.0379 24.1005C24.8621 24.2763 24.6236 24.3751 24.375 24.3751H5.625C5.37636 24.3751 5.1379 24.2763 4.96209 24.1005C4.78627 23.9247 4.6875 23.6863 4.6875 23.4376C4.6875 23.189 4.78627 22.9505 4.96209 22.7747C5.1379 22.5989 5.37636 22.5001 5.625 22.5001H24.375C24.6236 22.5001 24.8621 22.5989 25.0379 22.7747C25.2137 22.9505 25.3125 23.189 25.3125 23.4376ZM8.53594 5.10714C8.42467 4.88461 8.40636 4.62699 8.48504 4.39096C8.56372 4.15493 8.73294 3.95982 8.95547 3.84855C9.178 3.73728 9.43562 3.71898 9.67165 3.79765C9.90769 3.87633 10.1028 4.04555 10.2141 4.26808L11.1516 6.14308C11.2067 6.25327 11.2395 6.37323 11.2482 6.49611C11.257 6.619 11.2414 6.74239 11.2025 6.85927C11.1635 6.97614 11.1019 7.08419 11.0212 7.17726C10.9405 7.27032 10.8422 7.34658 10.732 7.40168C10.6218 7.45677 10.5019 7.48962 10.379 7.49835C10.2561 7.50709 10.1327 7.49153 10.0158 7.45257C9.89898 7.41362 9.79092 7.35202 9.69785 7.2713C9.60479 7.19059 9.52853 7.09233 9.47344 6.98214L8.53594 5.10714ZM1.97344 10.8306C2.02857 10.7204 2.10487 10.6222 2.19798 10.5416C2.29108 10.461 2.39916 10.3995 2.51605 10.3606C2.63293 10.3218 2.75632 10.3063 2.87917 10.3152C3.00203 10.324 3.12193 10.357 3.23203 10.4122L5.10703 11.3497C5.32941 11.461 5.49848 11.656 5.57705 11.892C5.65561 12.1279 5.63724 12.3854 5.52598 12.6077C5.41471 12.8301 5.21966 12.9992 4.98374 13.0777C4.74782 13.1563 4.49035 13.1379 4.26797 13.0267L2.39297 12.0892C2.28273 12.0341 2.18441 11.9579 2.10365 11.8649C2.02289 11.7718 1.96127 11.6637 1.9223 11.5468C1.88334 11.43 1.8678 11.3065 1.87657 11.1836C1.88535 11.0607 1.91826 10.9408 1.97344 10.8306ZM24.4734 12.6071C24.3624 12.3848 24.3442 12.1274 24.4229 11.8916C24.5015 11.6558 24.6706 11.4609 24.893 11.3497L26.768 10.4122C26.9903 10.301 27.2478 10.2826 27.4837 10.3612C27.7197 10.4397 27.9147 10.6088 28.026 10.8312C28.1372 11.0535 28.1556 11.311 28.077 11.5469C27.9985 11.7829 27.8294 11.9779 27.607 12.0892L25.732 13.0267C25.6219 13.0819 25.5019 13.1148 25.379 13.1235C25.2561 13.1323 25.1327 13.1168 25.0158 13.0778C24.8989 13.0388 24.7908 12.9772 24.6978 12.8965C24.6047 12.8157 24.5285 12.7174 24.4734 12.6071ZM18.8484 6.14308L19.7859 4.26808C19.8972 4.04555 20.0923 3.87633 20.3283 3.79765C20.5644 3.71898 20.822 3.73728 21.0445 3.84855C21.2671 3.95982 21.4363 4.15493 21.515 4.39096C21.5936 4.62699 21.5753 4.88461 21.4641 5.10714L20.5266 6.98214C20.4153 7.20468 20.2202 7.3739 19.9842 7.45257C19.7481 7.53125 19.4905 7.51294 19.268 7.40168C19.0454 7.29041 18.8762 7.0953 18.7975 6.85927C18.7189 6.62323 18.7372 6.36561 18.8484 6.14308Z" fill="black" />
                            </svg>
                            <?= $roomAmenities[0] ?></li>
                        <li><svg width="20" height="20" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M23.7374 3.19071C22.7995 2.64909 21.7641 2.29752 20.6903 2.15608C19.6165 2.01463 18.5254 2.08609 17.4792 2.36636C16.4331 2.64663 15.4524 3.13023 14.5931 3.78954C13.7338 4.44885 13.0129 5.27097 12.4713 6.20893L12.1606 6.74679C12.0543 6.93137 12.0256 7.15062 12.0808 7.35635C12.1361 7.56208 12.2708 7.73746 12.4553 7.84393L18.3063 11.2221L14.8049 17.3507L14.7321 17.3496C11.3485 17.3496 8.41813 19.3125 6.67277 22.0875C6.97076 21.9817 7.28851 21.9434 7.60311 21.9753C7.91771 22.0071 8.22132 22.1084 8.49205 22.2718C10.0049 20.2725 12.2613 18.9568 14.7321 18.9568C17.3078 18.9568 19.651 20.3871 21.1606 22.5311C21.3693 22.3389 21.6141 22.1901 21.8808 22.0933C22.1475 21.9966 22.4308 21.9538 22.7142 21.9675C21.2881 19.7625 19.1067 18.0889 16.5471 17.5414L19.6981 12.0257L25.3478 15.2882C25.4392 15.341 25.5402 15.3753 25.6449 15.3891C25.7496 15.4029 25.856 15.3959 25.9579 15.3685C26.0599 15.3412 26.1555 15.294 26.2393 15.2296C26.323 15.1653 26.3933 15.0851 26.446 14.9936L26.7567 14.4568C27.2983 13.5188 27.6498 12.4834 27.7912 11.4095C27.9325 10.3357 27.861 9.24454 27.5806 8.19837C27.3002 7.15219 26.8165 6.17149 26.1571 5.31227C25.4977 4.45305 24.6755 3.73214 23.7374 3.19071ZM21.391 11.1471L18.0074 9.19286C18.6203 8.24893 19.2031 7.53 19.9017 6.89464C20.5821 6.27536 21.3942 5.71607 22.4956 5.1075C22.6585 6.13072 22.7078 6.9825 22.6028 7.81821C22.4785 8.81679 22.126 9.84643 21.3888 11.1461M22.7796 11.9496C23.5938 10.5161 24.0396 9.28179 24.1971 8.0175C24.301 7.18821 24.2774 6.36964 24.1735 5.505C25.2359 6.50988 25.937 7.83726 26.1682 9.28126C26.3993 10.7253 26.1474 12.2052 25.4517 13.4914L22.7796 11.9496ZM18.8196 5.70536C17.9731 6.47571 17.2928 7.33286 16.6124 8.38821L13.9553 6.85393C14.705 5.63513 15.8282 4.69098 17.1577 4.16202C18.4873 3.63305 19.9521 3.54754 21.3342 3.91821C20.3388 4.49143 19.5288 5.05929 18.8196 5.70536ZM8.14813 23.8532C8.0931 23.6879 7.98583 23.5449 7.84247 23.4458C7.69911 23.3468 7.52744 23.297 7.35333 23.304C7.17921 23.311 7.0121 23.3745 6.87717 23.4847C6.74224 23.595 6.64681 23.7461 6.60527 23.9154C6.33205 25.0318 5.81455 25.6446 5.22527 26.0004C4.60812 26.3732 3.8217 26.5168 2.9442 26.5168C2.73108 26.5168 2.52668 26.6014 2.37599 26.7521C2.22529 26.9028 2.14062 27.1072 2.14062 27.3204C2.14062 27.5335 2.22529 27.7379 2.37599 27.8886C2.52668 28.0393 2.73108 28.1239 2.9442 28.1239C3.96955 28.1239 5.08705 27.9611 6.05563 27.3761C6.63364 27.0274 7.12086 26.5468 7.47741 25.9736C9.3942 28.4186 13.1367 28.4057 14.9978 25.9479C16.8888 28.4443 20.7192 28.4186 22.6081 25.8557C23.1209 26.5537 23.7897 27.1222 24.5611 27.516C25.3325 27.9098 26.1852 28.118 27.0513 28.1239C27.2645 28.1239 27.4689 28.0393 27.6196 27.8886C27.7703 27.7379 27.8549 27.5335 27.8549 27.3204C27.8549 27.1072 27.7703 26.9028 27.6196 26.7521C27.4689 26.6014 27.2645 26.5168 27.0513 26.5168C25.471 26.5168 23.896 25.4882 23.3763 23.8618C23.3249 23.6999 23.2235 23.5585 23.0868 23.4579C22.95 23.3572 22.7848 23.3025 22.615 23.3015C22.4452 23.3006 22.2794 23.3535 22.1415 23.4526C22.0036 23.5517 21.9006 23.6919 21.8474 23.8532C20.8156 26.97 16.771 26.9304 15.7574 23.9829C15.7029 23.8248 15.6004 23.6876 15.4642 23.5906C15.3281 23.4935 15.165 23.4413 14.9978 23.4413C14.8305 23.4413 14.6675 23.4935 14.5313 23.5906C14.3952 23.6876 14.2927 23.8248 14.2381 23.9829C13.2246 26.9304 9.18098 26.9689 8.14813 23.8532Z" fill="black" />
                            </svg> <?= $roomAmenities[1] ?></li>
                        <li><svg width="20" height="20" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.49997 5C7.00268 5 6.52577 5.19754 6.17414 5.54917C5.82251 5.90081 5.62497 6.37772 5.62497 6.875V7.8125C5.62497 8.06114 5.52619 8.2996 5.35038 8.47541C5.17456 8.65123 4.93611 8.75 4.68747 8.75C4.43883 8.75 4.20037 8.65123 4.02455 8.47541C3.84874 8.2996 3.74997 8.06114 3.74997 7.8125V6.875C3.74997 5.88044 4.14505 4.92661 4.84832 4.22335C5.55158 3.52009 6.5054 3.125 7.49997 3.125C8.49453 3.125 9.44835 3.52009 10.1516 4.22335C10.8549 4.92661 11.25 5.88044 11.25 6.875V11.25H20.625V6.875C20.625 6.37772 20.4274 5.90081 20.0758 5.54917C19.7242 5.19754 19.2472 5 18.75 5C18.2527 5 17.7758 5.19754 17.4241 5.54917C17.0725 5.90081 16.875 6.37772 16.875 6.875V7.8125C16.875 8.06114 16.7762 8.2996 16.6004 8.47541C16.4246 8.65123 16.1861 8.75 15.9375 8.75C15.6888 8.75 15.4504 8.65123 15.2746 8.47541C15.0987 8.2996 15 8.06114 15 7.8125V6.875C15 5.88044 15.3951 4.92661 16.0983 4.22335C16.8016 3.52009 17.7554 3.125 18.75 3.125C19.7445 3.125 20.6984 3.52009 21.4016 4.22335C22.1049 4.92661 22.5 5.88044 22.5 6.875V17.9469C21.8815 18.0618 21.254 18.1214 20.625 18.125V13.125H11.25V15.3269C10.6327 15.1859 10.0061 15.0894 9.37497 15.0381V6.875C9.37497 6.37772 9.17742 5.90081 8.82579 5.54917C8.47416 5.19754 7.99725 5 7.49997 5ZM3.34059 19.0525C3.18196 18.861 3.10589 18.6144 3.1291 18.3669C3.1523 18.1193 3.27289 17.8911 3.46434 17.7325L3.46559 17.7313L3.46684 17.7306L3.46934 17.7287L3.47559 17.7238L3.49122 17.7106C3.56043 17.6557 3.63196 17.6038 3.70559 17.555C3.8963 17.4266 4.09412 17.3092 4.29809 17.2031C4.99433 16.8443 5.73801 16.586 6.50684 16.4363C8.43809 16.0487 11.1768 16.1487 14.5837 17.8825C17.6837 19.4594 20.4237 19.5375 22.3806 19.235C23.1689 19.115 23.9421 18.9107 24.6868 18.6256C24.9543 18.5219 25.1587 18.4288 25.2912 18.3644C25.3581 18.3319 25.4062 18.3069 25.4362 18.2906L25.4668 18.2744L25.4681 18.2731H25.4693L25.4706 18.2725C25.6854 18.1561 25.9372 18.1283 26.1723 18.1948C26.4074 18.2613 26.6072 18.4169 26.7292 18.6286C26.8513 18.8402 26.8859 19.0911 26.8256 19.3279C26.7654 19.5647 26.6152 19.7686 26.4068 19.8962L26.4056 19.8969L26.4025 19.8988L26.3962 19.9025L26.3781 19.9125C26.2913 19.9613 26.2029 20.0071 26.1131 20.05C25.9368 20.1356 25.685 20.25 25.3643 20.3744C24.4935 20.7081 23.5894 20.9472 22.6675 21.0875C20.3862 21.4413 17.2368 21.3363 13.7337 19.5537C10.6887 18.0044 8.37934 17.9725 6.87559 18.2744C6.11559 18.4269 5.54184 18.6681 5.16747 18.8644C4.99458 18.9546 4.82814 19.0568 4.66934 19.17L4.65497 19.1806C4.46329 19.337 4.21759 19.4113 3.97139 19.3873C3.72519 19.3633 3.49846 19.2429 3.34059 19.0525ZM3.34059 24.6775C3.18196 24.486 3.10589 24.2394 3.1291 23.9919C3.1523 23.7443 3.27289 23.5161 3.46434 23.3575L3.46559 23.3562L3.46684 23.3556L3.46934 23.3531L3.47559 23.3488L3.49122 23.3356C3.56043 23.2807 3.63196 23.2288 3.70559 23.18C3.8963 23.0516 4.09412 22.9342 4.29809 22.8281C4.99433 22.4693 5.73801 22.2111 6.50684 22.0613C8.43809 21.6737 11.1768 21.7738 14.5837 23.5075C17.6837 25.0844 20.4237 25.1625 22.3806 24.86C23.1689 24.74 23.9421 24.5357 24.6868 24.2506C24.9543 24.1469 25.1587 24.0537 25.2912 23.9894C25.3581 23.9569 25.4062 23.9312 25.4362 23.9156L25.4668 23.8994L25.4681 23.8981H25.4693L25.4706 23.8975C25.6854 23.7811 25.9372 23.7533 26.1723 23.8198C26.4074 23.8863 26.6072 24.0419 26.7292 24.2536C26.8513 24.4652 26.8859 24.7161 26.8256 24.9529C26.7654 25.1897 26.6152 25.3936 26.4068 25.5212L26.4056 25.5219L26.405 25.5225L26.4025 25.5238L26.3962 25.5275L26.3781 25.5375C26.2913 25.5863 26.2029 25.6321 26.1131 25.675C25.9368 25.7606 25.685 25.875 25.3643 25.9994C24.4935 26.3331 23.5894 26.5722 22.6675 26.7125C20.3862 27.0663 17.2368 26.9613 13.7337 25.1787C10.6887 23.6294 8.37934 23.5975 6.87559 23.8994C6.11559 24.0519 5.54184 24.2931 5.16747 24.4894C4.99458 24.5796 4.82814 24.6818 4.66934 24.795L4.65497 24.8056C4.46329 24.962 4.21759 25.0363 3.97139 25.0123C3.72519 24.9883 3.49846 24.8679 3.34059 24.6775Z" fill="black" />
                            </svg> <?= $roomAmenities[2] ?></li>
                    </ul>
                    <a href="#booking-form"><button>Book this room</button></a>
                </div>
                <div class="room-images">
                    <div class="room-img-wide" style="background-image: url('<?= $roomImg ?>');"></div>
                    <div class="img-group">
                        <div class="room-img-square-1"></div>
                        <div class="room-img-square-2"></div>
                        <div class="room-img-square-3"></div>
                    </div>
                    <a href="">Show more (23)</a>
                </div>
            </div>
            <!-- BOOKING FORM -->
            <div id="booking-form" class="booking-form">
                <?php //Booking form validation
                require_once __DIR__ . '/booking.php';
                ?>

                <h3>Book this room</h3>
                <p>Arrival date: <?= $checkIn ?> | Departure date: <?= $checkOut ?> <a href="/" style="color:var(--water);">(Change room or dates)</a></p>
                <div>
                    <!-- PRESENTATION -->

                    <!-- If any errors, display them here -->
                    <?php if ($errors) { ?>
                        <script>
                            window.location.href = "#booking-form";
                        </script>
                        <div id="error" class="error">
                            <p><strong>Oh no! There seems to be an issue:</strong></p>
                            <?php
                            if (isset($errors)) {
                                foreach ($errors as $error) { ?>
                                    <p><?php echo "- " . $error; ?></p>
                        <?php }
                            }
                        } ?>
                        </div>

                        <!-- FORM FOR BOOKING -->

                        <form class="book" action="" method="post">
                            <div class="form-container">
                                <h4>Name</h4>
                                <div class="form-div">
                                    <input type="text" id="fullname" name="fullname" placeholder="Full name" value="<?php echo isset($guestName) ? $guestName : ''; ?>">
                                </div>
                                <h4>Contact information</h4>
                                <div class="form-div">
                                    <input type="text" id="email" name="email" placeholder="E-mail" value="<?php echo isset($guestEmail) ? $guestEmail : ''; ?>">
                                </div>
                                <h4>Feature - optional</h4>
                                <div class="features">

                                    <?php
                                    // Generate list of features
                                    $statement = $db->query("SELECT * FROM Features");
                                    $features = $statement->fetchAll(PDO::FETCH_ASSOC);
                                    foreach ($features as $feature) {
                                        // Check if feature is selected in order to save the checked feature if form submit fails
                                        $isChecked = false;
                                        if (!empty($selectedFeatures)) {
                                            if (in_array($feature['feature_name'], $selectedFeatures)) {
                                                $isChecked = true;
                                            }
                                        } ?>

                                        <div class="feature">
                                            <input type="checkbox" id="<?= $feature['feature_name']; ?>" name="features[]" value="<?= $feature['feature_name']; ?>">
                                            <label for="<?= $feature['feature_name']; ?>"><?= $feature['feature_name'] . " (+$" . $feature['extra_cost'] . ")"; ?></label>
                                        </div>
                                    <?php } ?>
                                </div>
                            </div>
                            <div class="form-container">
                                <h4>Confirmation</h4>
                                <div id="total_cost"></div>
                                <div class="form-div">
                                    <input type="text" id="transfercode" name="transfer_code" placeholder="Transfer code" value="<?php echo isset($guestCode) ? $guestCode : ''; ?>">
                                    <input type="submit" id="book_room" name="book_room" value="Book room">
                                </div>
                            </div>
                        </form>
                </div>
            </div>
        </section>
    </main>
    <?php include __DIR__ . '/totalcost.php'; ?>
    <footer>
        <div class="footer-column">
            <h4>RAINBOW REEF RETREAT</h4>
            <div class="divider"></div>
            <a href="/">Location</a>
            <a href="/">Rooms</a>
            <a href="/">Restaurant</a>
            <a href="/">Activities</a>
        </div>
        <div class="footer-column">
            <h4>CONTACT</h4>
            <div class="divider"></div>
            <p>+12 345 678 90</p>
            <a href="/">hello@rainbowreefretreat.com</a>
            <p>Rainbow Reef Retreat</p>
            <p>42 Ocean View Lane</p>
            <p>12345 Rainbow Reef Island</p>
        </div>
        <div class="footer-column">
            <h4>CUSTOMER SERVICE</h4>
            <div class="divider"></div>
            <a href="/">FAQ</a>
            <a href="/">Booking policy</a>
        </div>
    </footer>
</body>

</html>